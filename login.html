<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - VSoft</title>
<style>
    /* RESET BÁSICO */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
    
    /* ESTILO DO BODY E FUNDO */
    body {
        background: linear-gradient(135deg, #0d1a2a, #2c3e50);
        min-height: 100vh; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        color: #f4f4f4;
    }
    
    /* CONTAINER PRINCIPAL DE LOGIN */
    .login-container {
        max-width: 400px; 
        width: 100%; 
        background: rgba(255,255,255,0.1);
        border-radius: 15px; 
        text-align: center; 
        padding: 40px 30px;
        backdrop-filter: blur(10px); 
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .logo { font-size: 48px; font-weight: bold; color: #3498db; margin-bottom: 10px; }
    h1 { font-size: 26px; margin-bottom: 5px; }
    .description { opacity: .8; margin-bottom: 25px; }
    
    /* CAMPOS DE INPUT */
    input { 
        width: 100%; 
        padding: 12px; 
        margin-bottom: 15px; 
        border-radius: 8px; 
        border: none; 
    }
    
    /* BOTÕES GERAIS */
    button { 
        width: 100%; 
        padding: 12px; 
        font-weight: bold; 
        border-radius: 50px; 
        border: none; 
        cursor: pointer; 
    }
    
    /* BOTÕES ESPECÍFICOS DO LOGIN */
    .login-btn { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
    .register-btn { background: linear-gradient(135deg, #007bff, #0056b3); color: white; margin-top: 10px; }
    
    /* MENSAGEM DE ERRO */
    .error { color: #ff4444; margin-top: 10px; display: none; }
    
    /* MODAL DE CADASTRO */
    .modal { 
        display: none; 
        position: fixed; 
        inset: 0; 
        background: rgba(0,0,0,0.6); 
        justify-content: center; 
        align-items: center; 
    }
    .modal-content { 
        background: white; 
        padding: 30px; 
        border-radius: 10px; 
        max-width: 400px; 
        text-align: center; 
        color: #222; 
    }
    
    /* BOTÕES DENTRO DO MODAL - RESTAURADOS PARA 100% */
    .close-btn { 
        background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 20px; 
        margin-top: 10px; cursor: pointer; width: 100%; 
    }
    .confirm-btn { 
        background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 20px; 
        margin-top: 10px; cursor: pointer; width: 100%; margin-bottom: 10px; 
    }
    .access-password-section { margin-bottom: 15px; }
</style>
</head>
<body>
<div class="login-container">
    <div class="logo">VSoft</div>
    <h1>Acesso ao Painel</h1>
    <p class="description">Insira suas credenciais para continuar</p>

    <input type="text" id="username" placeholder="Usuário" required>
    <input type="password" id="password" placeholder="Senha" required>
    <button class="login-btn" id="login-btn">Entrar</button>
    <button class="register-btn" id="open-register">Cadastrar Usuário</button>
    <div class="error" id="login-error">Usuário ou senha incorretos.</div>
</div>

<div class="modal" id="register-modal">
    <div class="modal-content">
        <h2>Cadastrar Novo Usuário</h2>
        
                <div class="access-password-section">
            <input type="password" id="access-password" placeholder="Senha de Acesso (otimus32)" required>
        </div>
        
                <input type="text" id="new-user" placeholder="Novo Usuário">
        <input type="password" id="new-pass" placeholder="Nova Senha">
        <button class="confirm-btn" id="register-confirm">Cadastrar</button> 
        <button class="close-btn" id="close-register">Fechar</button>
        <p id="register-msg" style="margin-top:10px;"></p>
    </div>
</div>

<script>
// URL da sua API hospedada. 
const API_BASE = "https://base-2-new-new-9xow.vercel.app/";

// --- LÓGICA DE LOGIN ---
document.getElementById("login-btn").addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const err = document.getElementById("login-error");
    err.style.display = "none"; // Limpa o erro ao tentar login

    try {
        const res = await fetch(`${API_BASE}api/login`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username, password })
        });
        
        // Trata a resposta de erro do servidor (ex: 401 Unauthorized)
        if (!res.ok) {
            const data = await res.json();
            err.textContent = data.message || "Usuário ou senha incorretos.";
            err.style.display = "block";
            return;
        }

        const data = await res.json();
        if (data.authenticated) {
            window.location.href = "menu.html";
        } else {
            err.textContent = data.message || "Usuário ou senha incorretos.";
            err.style.display = "block";
        }
    } catch (e) {
        console.error("Erro de conexão de rede durante o login:", e);
        // Trata falha na conexão de rede (API Inalcançável)
        err.textContent = "Erro ao conectar com o servidor. Verifique a URL da API.";
        err.style.display = "block";
    }
});

// --- LÓGICA DO MODAL (ABRIR/FECHAR) ---
const modal = document.getElementById("register-modal");
document.getElementById("open-register").onclick = () => {
    // Limpar campos ao abrir o modal
    document.getElementById("access-password").value = "";
    document.getElementById("new-user").value = "";
    document.getElementById("new-pass").value = "";
    document.getElementById("register-msg").textContent = "";
    modal.style.display = "flex";
};
document.getElementById("close-register").onclick = () => modal.style.display = "none";

// --- LÓGICA DE CADASTRO ---
document.getElementById("register-confirm").addEventListener("click", async () => {
    const accessPassword = document.getElementById("access-password").value.trim();
    const login = document.getElementById("new-user").value.trim();
    const senha = document.getElementById("new-pass").value.trim();
    const msg = document.getElementById("register-msg");
    msg.textContent = ""; // Limpa a mensagem anterior

    // Validar senha de acesso (Frontend)
    if (accessPassword !== "otimus32") {
        msg.style.color = "red";
        msg.textContent = "Senha de acesso incorreta!";
        return;
    }

    if (!login || !senha) {
        msg.style.color = "red";
        msg.textContent = "Preencha todos os campos.";
        return;
    }

    try {
        const res = await fetch(`${API_BASE}api/users`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ login, senha, accessPassword: "otimus32" })
        });
        
        // Trata erros de resposta do servidor (4xx, 5xx)
        if (!res.ok) {
            const errorData = await res.json();
            msg.style.color = "red";
            msg.textContent = errorData.message || `Erro ao criar usuário. Status: ${res.status}.`;
            return;
        }

        // Sucesso (Status 201 Created)
        const data = await res.json();
        msg.style.color = "green";
        msg.textContent = "Usuário criado com sucesso!";
        setTimeout(() => {
            modal.style.display = "none";
            // Limpar campos após cadastro bem-sucedido
            document.getElementById("access-password").value = "";
            document.getElementById("new-user").value = "";
            document.getElementById("new-pass").value = "";
        }, 2000);
    } catch (err) {
        console.error("Erro de conexão de rede durante o cadastro:", err);
        // Trata falha na conexão de rede (API Inalcançável)
        msg.style.color = "red";
        msg.textContent = "Erro ao conectar com o servidor. Verifique a URL da API.";
    }
});
</script>
</body>
</html>
