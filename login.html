<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - VSoft</title>
<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
        background: linear-gradient(135deg, #0d1a2a 0%, #2c3e50 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #f4f4f4;
        padding: 20px;
    }
    .login-container {
        max-width: 400px;
        width: 100%;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        text-align: center;
        padding: 40px 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    .logo {
        font-size: 48px;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 10px;
    }
    h1 {
        font-size: 28px;
        margin-bottom: 5px;
    }
    .description {
        font-size: 16px;
        opacity: 0.8;
        margin-bottom: 30px;
    }
    .form-group {
        margin-bottom: 20px;
        text-align: left;
    }
    label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
    }
    input[type="text"], input[type="password"] {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.85);
        color: #1f1f1f;
        transition: border-color 0.3s ease;
    }
    input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    button {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        background: linear-gradient(135deg, #28a745, #1e7e34);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    button:hover {
        background: linear-gradient(135deg, #218838, #1e7e34);
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    .secondary-btn {
        margin-top: 15px;
        background: linear-gradient(135deg, #007bff, #0056b3);
    }
    .secondary-btn:hover {
        background: linear-gradient(135deg, #0069d9, #0056b3);
    }
    .error-message, .success-message {
        margin-top: 15px;
        font-weight: bold;
        display: none;
    }
    .error-message { color: #dc3545; }
    .success-message { color: #28a745; }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.7);
        justify-content: center;
        align-items: center;
    }
    .modal-content {
        background: #fff;
        color: #222;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    .modal-content input {
        margin: 10px 0;
    }
    .close-btn {
        background: #dc3545;
        margin-top: 10px;
    }
    .close-btn:hover {
        background: #b52a37;
    }
</style>
</head>
<body>
<div class="login-container">
    <div class="logo">VSoft</div>
    <h1>Acesso ao Painel</h1>
    <p class="description">Insira suas credenciais para continuar.</p>

    <form id="login-form">
        <div class="form-group">
            <label for="username">Usuário:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="form-group">
            <label for="password">Senha:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <button type="submit">Entrar</button>
    </form>

    <button class="secondary-btn" id="register-btn">Cadastrar Usuário</button>

    <p class="error-message" id="error-message">Usuário ou senha incorretos. Tente novamente.</p>
</div>

<!-- Modal de Senha Mestra -->
<div id="master-modal" class="modal">
    <div class="modal-content" id="master-step">
        <h3>Autenticação Necessária</h3>
        <p>Digite a senha mestra para liberar o cadastro:</p>
        <input type="password" id="master-password" placeholder="Senha mestra">
        <button id="verify-master">Verificar</button>
        <button class="close-btn" onclick="closeModal()">Cancelar</button>
        <p class="error-message" id="master-error">Senha incorreta.</p>
    </div>

    <!-- Formulário de Cadastro (inicialmente oculto) -->
    <div class="modal-content" id="register-step" style="display:none;">
        <h3>Cadastrar Novo Usuário</h3>
        <input type="text" id="new-username" placeholder="Usuário" required>
        <input type="password" id="new-password" placeholder="Senha" required>
        <button id="create-user">Cadastrar</button>
        <button class="close-btn" onclick="closeModal()">Fechar</button>
        <p class="success-message" id="success-register">Usuário criado com sucesso!</p>
        <p class="error-message" id="error-register">Erro ao criar usuário.</p>
    </div>
</div>

<script>
    const registerBtn = document.getElementById('register-btn');
    const masterModal = document.getElementById('master-modal');
    const masterStep = document.getElementById('master-step');
    const registerStep = document.getElementById('register-step');
    const masterError = document.getElementById('master-error');
    const successRegister = document.getElementById('success-register');
    const errorRegister = document.getElementById('error-register');

    function closeModal() {
        masterModal.style.display = 'none';
        masterStep.style.display = 'block';
        registerStep.style.display = 'none';
        document.getElementById('master-password').value = '';
        masterError.style.display = 'none';
        successRegister.style.display = 'none';
        errorRegister.style.display = 'none';
    }

    registerBtn.addEventListener('click', () => {
        masterModal.style.display = 'flex';
    });

    document.getElementById('verify-master').addEventListener('click', () => {
        const masterPass = document.getElementById('master-password').value;
        if (masterPass === 'otimus32') {
            masterStep.style.display = 'none';
            registerStep.style.display = 'block';
        } else {
            masterError.style.display = 'block';
        }
    });

    document.getElementById('create-user').addEventListener('click', async () => {
        const login = document.getElementById('new-username').value.trim();
        const senha = document.getElementById('new-password').value.trim();
        successRegister.style.display = 'none';
        errorRegister.style.display = 'none';

        if (!login || !senha) {
            errorRegister.textContent = 'Preencha todos os campos.';
            errorRegister.style.display = 'block';
            return;
        }

        try {
            const response = await fetch('/api/users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ login, senha })
            });

            if (response.ok) {
                successRegister.style.display = 'block';
                document.getElementById('new-username').value = '';
                document.getElementById('new-password').value = '';
            } else {
                errorRegister.textContent = 'Erro ao criar usuário.';
                errorRegister.style.display = 'block';
            }
        } catch (error) {
            console.error('Erro:', error);
            errorRegister.textContent = 'Falha de conexão com o servidor.';
            errorRegister.style.display = 'block';
        }
    });

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorMessage = document.getElementById('error-message');

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (response.ok) {
                const data = await response.json();
                if (data.authenticated) {
                    window.location.href = 'menu.html';
                } else {
                    errorMessage.style.display = 'block';
                }
            } else {
                errorMessage.style.display = 'block';
            }
        } catch (error) {
            console.error('Erro:', error);
            errorMessage.textContent = 'Erro ao conectar com o servidor.';
            errorMessage.style.display = 'block';
        }
    });
</script>
</body>
</html>
