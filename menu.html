<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base para N2 - VSoft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #0d1a2a;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo {
            font-size: 40px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .description {
            font-size: 16px;
            opacity: 0.9;
        }

        main {
            padding: 20px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .menu-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #333;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: #3498db;
        }

        .card-icon {
            font-size: 40px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .card-description {
            font-size: 14px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
        }
        .logout-button {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 16px;
            background: linear-gradient(135deg, #dc3545, #b42a35);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
        }
        .logout-button:hover {
            background: linear-gradient(135deg, #c82333, #a71d24);
        }

        /* --- Estilos do Chatbot --- */
        #chat-widget-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: #f4f4f4;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
            display: none; /* Inicia oculto */
        }
        #chat-header {
            background: #3498db;
            color: white;
            padding: 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chat-header i {
            margin-right: 5px;
        }
        #chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        #chat-body {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 10px;
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 5px;
            background: #e9ecef;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 15px;
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .user-message {
            background: #3498db;
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        .bot-message {
            background: #ffffff;
            color: #333;
            align-self: flex-start;
            margin-right: auto;
            border: 1px solid #ddd;
            border-bottom-left-radius: 5px;
            white-space: pre-wrap;
        }
        #chat-input-container {
            display: flex;
            padding: 5px 0;
        }
        #chat-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            margin-right: 10px;
        }
        #chat-send-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: background 0.3s;
        }
        #chat-send-btn:hover {
            background: #218838;
        }
        #chat-open-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            z-index: 1000;
        }
        #chat-open-btn i {
            margin-right: 8px;
        }
        /* Indicador de Digitação */
        .typing-indicator {
            background: #e0e0e0;
            color: #555;
            padding: 5px 10px;
            border-radius: 15px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">VSoft</div>
            <h1>Base para N2</h1>
            <p class="description">Central de guias e documentações técnicas para suporte de Nível 2.</p>
        </header>

        <main>
            <div class="menu-grid">
                
                <a href="endpoints.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-share-alt"></i></div>
                    <div>
                        <h2 class="card-title">Documentação Endpoints RN</h2>
                        <p class="card-description">Documentação técnica com os Endpoints de RN</p>
                    </div>
                </a>

                <a href="Sergipe.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-share-alt"></i></div>
                    <div>
                        <h2 class="card-title">Documentação Endpoints SE</h2>
                        <p class="card-description">Documentação técnica com os Endpoints de SE</p>
                    </div>
                </a>
                
                <a href="mshm.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-share-alt"></i></div>
                    <div>
                        <h2 class="card-title">Integrações DETRAN-MS / Valid</h2>
                        <p class="card-description">Documentação completa de fluxos, jobs e endpoints de API.</p>
                    </div>
                </a>
                <a href="endpoints_df.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-share-alt"></i></div>
                    <div>
                        <h2 class="card-title">Endpoints Credenciadas DF</h2>
                        <p class="card-description">Documentação completa de fluxos, jobs e endpoints de API.</p>
                    </div>
                </a>
                <a href="SuperPratico.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-share-alt"></i></div>
                    <div>
                        <h2 class="card-title">Integrações SuperPrático/ Aulas Praticas</h2>
                        <p class="card-description">Documentação completa de fluxos Do SuperPrático.</p>
                    </div>
                </a>
                <a href="gerenciamento_incidentes.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-share-alt"></i></div>
                    <div>
                        <h2 class="card-title">Politica de gerenciamento de incidentes</h2>
                        <p class="card-description">Documentação completa do gerenciamento de incidente.</p>
                    </div>
                </a>
                <a href="menu2.html" class="menu-card">
                    <div class="card-icon"><i class="fas fa-table"></i></div>
                    <div>
                        <h2 class="card-title">Registro Diários</h2>
                        <p class="card-description">Base de registro diário do N2</p>
                    </div>
                </a>

            </div>
        </main>
        <button class="logout-button" onclick="logout()">Sair</button>
    </div>

    <div id="chat-widget-container">
        <div id="chat-header">
            Assistente VSoft N2 <i class="fas fa-robot"></i>
            <button id="chat-close-btn" onclick="toggleChat()">X</button>
        </div>
        <div id="chat-body">
            <div id="chat-messages">
                <div class="message bot-message">
                    Olá! Sou seu assistente de suporte N2. Posso te dar endpoints por estado (RN, DF, SE, MS) ou detalhes sobre a **Política de Incidentes**.
                    <br><br>
                    **Dica de Memória:** Use o comando `/lembrar [sua informação]` para me ensinar algo que vou guardar **permanentemente** no banco.
                </div>
            </div>
            <div id="chat-input-container">
                <input type="text" id="chat-input" placeholder="Ex: 'endpoints RN', 'MTTR crítico' ou '/lembrar...'">
                <button id="chat-send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <button id="chat-open-btn" onclick="toggleChat()" style="display: none;">
        <i class="fas fa-comment-dots"></i> Chat N2
    </button>
    
    <script>
        // Variável global para armazenar as memórias carregadas do MongoDB
        let chatMemories = []; 

        // *** ATENÇÃO: SUBSTITUA ESTA URL PELA URL REAL DO SEU BACKEND/VERCEL ***
        const BACKEND_URL = 'http://localhost:3000'; 
        // Se você está usando HTTPS, use a URL pública da sua API
        
        function logout() {
            // Limpa o estado de login
            localStorage.removeItem('agenteSelecionado');
            localStorage.removeItem('estadoSelecionado');
            // Redireciona para a tela de login
            window.location.href = 'login.html';
        }

        // Função para mostrar/ocultar o chat
        function toggleChat() {
            const chatWidget = document.getElementById('chat-widget-container');
            const chatOpenBtn = document.getElementById('chat-open-btn');

            if (chatWidget.style.display === 'flex') {
                chatWidget.style.display = 'none';
                chatOpenBtn.style.display = 'block';
            } else {
                chatWidget.style.display = 'flex';
                chatOpenBtn.style.display = 'none';
                document.getElementById('chat-input').focus();
            }
        }

        // Função para carregar todas as memórias do MongoDB
        async function loadMemoriesFromDatabase() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/memories`);
                if (response.ok) {
                    const data = await response.json();
                    // Sobrescreve a memória global com os dados do banco
                    chatMemories = data;
                    console.log(`[MongoDB] ${data.length} memórias carregadas.`);
                } else {
                    console.error('Erro ao carregar memórias:', response.status);
                }
            } catch (error) {
                console.error('Erro de rede ao carregar memórias:', error);
            }
        }

        // Inicialmente, mostra o botão flutuante e oculta o widget completo
        document.addEventListener('DOMContentLoaded', async () => { 
            document.getElementById('chat-open-btn').style.display = 'block';
            await loadMemoriesFromDatabase(); // Carrega as memórias do banco ao iniciar
        });

        // Adicionar evento para enviar mensagem ao pressionar Enter
        document.getElementById('chat-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Função para salvar a memória no MongoDB
        async function saveMemoryToDatabase(memoryText) {
            // Tenta obter o agente logado ou usa um padrão
            const agenteLogado = localStorage.getItem('agenteSelecionado') || 'SuporteN2'; 
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/memories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        agente: agenteLogado,
                        texto: memoryText
                    })
                });

                if (response.ok) {
                    // Recarrega as memórias globais após salvar com sucesso
                    await loadMemoriesFromDatabase(); 
                    return `**MEMÓRIA SALVA PERMANENTEMENTE!** Seu lembrete foi registrado no MongoDB e está disponível.`;
                } else {
                    return `Erro ao salvar no banco. Status: ${response.status}.`;
                }
            } catch (error) {
                console.error('Erro de rede ao salvar memória:', error);
                return `Erro de conexão com o servidor. Verifique se o backend está rodando em ${BACKEND_URL}.`;
            }
        }

        // Função para lidar com comandos de memória (simulação do memory tool)
        async function handleMemoryCommands(message) {
            const lowerCaseMessage = message.toLowerCase();

            // 1. Comando explícito para "lembrar" (/lembrar)
            if (lowerCaseMessage.startsWith("/lembrar ")) {
                const memory = message.substring("/lembrar ".length).trim();
                if (memory) {
                    // Chama a função assíncrona para salvar
                    return await saveMemoryToDatabase(memory); 
                }
                return "Por favor, use o formato: `/lembrar [informação que você quer que eu guarde]`.";
            }

            // 2. Comando explícito para "ver memórias" (/minhas memorias)
            if (lowerCaseMessage.includes("/minhas memorias") || lowerCaseMessage.includes("/minhasmemórias")) {
                // Garante que as memórias mais recentes estão carregadas
                await loadMemoriesFromDatabase(); 

                if (chatMemories.length === 0) {
                    return "Eu não tenho nenhuma informação armazenada no banco de dados para esta sessão. Use `/lembrar [informação]` para me ensinar algo.";
                }

                // Formata e exibe as 5 memórias mais recentes
                const latestMemories = chatMemories.slice(0, 5).map(m => {
                    const date = new Date(m.dataHora).toLocaleDateString('pt-BR');
                    return `* [${date}] ${m.texto} (Agente: ${m.agente})`;
                }).join('\n');
                
                return `As **${chatMemories.length}** informações salvas permanentemente (últimas 5):\n\n` + latestMemories;
            }
            
            return null; // Indica que não foi um comando de memória
        }


        // Função principal de envio e resposta
        async function sendMessage() { 
            const input = document.getElementById('chat-input');
            const messageText = input.value.trim();
            
            if (messageText === "") return;

            // 1. Adicionar a mensagem do usuário
            appendMessage(messageText, 'user-message');
            input.value = '';
            
            showTypingIndicator();

            // 2. Processar a mensagem
            const memoryResponse = await handleMemoryCommands(messageText);

            setTimeout(() => {
                hideTypingIndicator();
                
                let botResponse;

                if (memoryResponse) {
                    botResponse = memoryResponse;
                } else {
                    // Se não for um comando de memória, usa a base de conhecimento (RN/Política/Outros)
                    botResponse = getBotResponse(messageText);
                }

                appendMessage(botResponse, 'bot-message');
            }, 1500);
        }

        function appendMessage(text, className) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            
            // Permite formatação markdown básica no texto da resposta
            messageDiv.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message typing-indicator';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = 'Digitando...'; 
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // --- Lógica de Resposta do Chatbot (Baseado nas suas docs) ---
        function getBotResponse(message) {
            const lowerCaseMessage = message.toLowerCase();

            // --------------------------------------------------------
            // --- RN (Rio Grande do Norte) - FOCO PRINCIPAL ---
            // --------------------------------------------------------
            if (lowerCaseMessage.includes("rio grande do norte") || lowerCaseMessage.includes("rn") || lowerCaseMessage.includes("detran-rn")) {
                if (lowerCaseMessage.includes("endpoints") || lowerCaseMessage.includes("consulta") || lowerCaseMessage.includes("webservice")) {
                    let response = "Os WebServices do DetranNet-RN disponibilizam os seguintes métodos:\n\n";
                    response += "**Consultas Cadastrais e Agendamento:**\n";
                    [cite_start]response += "ConsultaCFC (opcional CNPJ) [cite: 138, 140]\n";
                    [cite_start]response += "ConsultaInstrutor (requer CNPJ) [cite: 142, 144]\n";
                    [cite_start]response += "ConsultaVeiculo (requer CNPJ) [cite: 146, 148]\n";
                    [cite_start]response += "ConsultaCandidato (requer CPF e CNPJ) [cite: 154, 156]\n";
                    [cite_start]response += "ConsultaAgendamentoPratico (requer CNPJ, Data) [cite: 158, 160]\n\n";
                    response += "**Confirmação de Aulas (Envio):**\n";
                    [cite_start]response += "ConfirmacaoAulaPratica [cite: 168]\n";
                    [cite_start]response += "ConfirmacaoAulaTeorica [cite: 174]";
                    return response;
                }
                if (lowerCaseMessage.includes("fluxo") || lowerCaseMessage.includes("processo") || lowerCaseMessage.includes("aula")) {
                    [cite_start]return "O fluxo para aulas monitoradas segue 4 etapas principais: 1. CFC realiza a **matrícula** no DetranNet[cite: 119]. 2. [cite_start]Sistema de Monitoramento **sincroniza** os dados[cite: 121, 123]. 3. [cite_start]Instrutor/Aluno iniciam e finalizam a aula com **biometria**[cite: 124, 126]. 4. [cite_start]Sistema de Monitoramento **envia o resumo** para o DetranNet, que contabiliza o curso[cite: 127, 128].";
                }
                if (lowerCaseMessage.includes("erro") && (lowerCaseMessage.includes("abertura") || lowerCaseMessage.includes("060"))) {
                    [cite_start]return "O **Erro 060** refere-se a **Erros de Identificação** (Instrutor/Aluno)[cite: 276].\n" +
                           "Causas comuns de erros de abertura:\n" +
                           [cite_start]"* **Identificação:** CPFs inválidos/inativos, matrícula expirada, categoria incompatível[cite: 277].\n" +
                           [cite_start]"* **Agendamento:** Aula fora do horário permitido (Regra: Agendamento deve ser no intervalo de 15 minutos do início da telemetria)[cite: 286, 299].";
                }
                if (lowerCaseMessage.includes("alerta") || lowerCaseMessage.includes("regra") || lowerCaseMessage.includes("fraude")) {
                    let response = "**AULA COM ALERTA (Prática)** é considerada quando (Exemplos):\n";
                    [cite_start]response += "* Veículo parado por mais de **10 minutos** (exceto aulas de PARADA E ESTACIONAMENTO)[cite: 215].\n";
                    [cite_start]response += "* Não houve detecção de pelo menos **uma face humana** nas imagens capturadas[cite: 217].\n";
                    [cite_start]response += "* Horário coincidente entre a aula e outra aula com o **mesmo veículo** ou **mesmo aluno/instrutor**[cite: 219, 220].";
                    return response;
                }
                if (lowerCaseMessage.includes("confirmacao") && lowerCaseMessage.includes("pratica")) {
                     [cite_start]return "O método **ConfirmacaoAulaPratica** envia biometrias de Entrada/Saída do Aluno e Instrutor, Placa, CNPJCFC, etc.[cite: 170, 171].\n\n" +
                            [cite_start]"**Regra Crítica:** A aula não será aceita se a digital não for validada e não houver foto no envio[cite: 173]. [cite_start]O **CodigoRetorno 0** indica Sucesso[cite: 172].";
                }
                 if (lowerCaseMessage.includes("agendamento") && lowerCaseMessage.includes("teorico")) {
                     [cite_start]return "O agendamento teórico (atualização e formação) é realizado **dentro do sistema SuperPrático**[cite: 321].\n\n" +
                            [cite_start]"O fluxo é: **Importar Candidato** > **Criar Turma** > **Agendamento** (repetir para todos os dias e manter 'É virtual' selecionada) > **Inserir Alunos na Turma**[cite: 322, 323, 324, 327, 328].";
                }
                [cite_start]return "Temos informações detalhadas sobre o **Fluxo de Aulas** [cite: 117][cite_start], **WebServices** (Consulta e Confirmação) [cite: 130][cite_start], regras de **Alerta** [cite: 214] [cite_start]e erros de **Abertura de Aula** (Erro 060) [cite: 276] para o RN. Qual tópico você precisa?";
            }

            // --------------------------------------------------------
            // --- POLÍTICA DE INCIDENTES (PL.SC.04.00) ---
            // --------------------------------------------------------
            const isPolicyRequest = lowerCaseMessage.includes("política") || lowerCaseMessage.includes("incidente") || lowerCaseMessage.includes("sla") || lowerCaseMessage.includes("problema") || lowerCaseMessage.includes("mttr") || lowerCaseMessage.includes("responsabilidade") || lowerCaseMessage.includes("ciclo") || lowerCaseMessage.includes("categorização");

            if (isPolicyRequest) {
                if (lowerCaseMessage.includes("sla") || lowerCaseMessage.includes("mttr") || lowerCaseMessage.includes("tempo de resposta")) {
                    if (lowerCaseMessage.includes("crítico")) {
                        return "SLA Incidente **Crítico**:\n- Resp. [cite_start]Inicial: **5 minutos** [cite: 77][cite_start]\n- MTTR: **2 a 4 horas** [cite: 77][cite_start]\n\nSLA Problema **Crítico**:\n- MTTR: **5 a 10 dias úteis** [cite: 79]";
                    }
                    if (lowerCaseMessage.includes("alto")) {
                        return "SLA Incidente **Alto**:\n- Resp. [cite_start]Inicial: **10 minutos** [cite: 77][cite_start]\n- MTTR: **Até 6h úteis** [cite: 77][cite_start]\n\nSLA Problema **Alto**:\n- MTTR: **11 a 15 dias úteis** [cite: 79]";
                    }
                    if (lowerCaseMessage.includes("baixo")) {
                         return "SLA Incidente **Baixo**:\n- Resp. [cite_start]Inicial: **2 horas** [cite: 77][cite_start]\n- MTTR: **Até 7 dias úteis** [cite: 77][cite_start]\n\nSLA Problema **Baixo**:\n- MTTR: **21 a 40 dias úteis/backlog** [cite: 79]";
                    }
                    [cite_start]let response = "Tempos de Recuperação (MTTR) e Resposta Inicial da Política PL.SC.04.00[cite: 75]:\n\n";
                    response += "**Crítico** (Incidente): Resp. [cite_start]Inicial: 5 min, MTTR: 2-4h [cite: 77]\n";
                    response += "**Alto** (Incidente): Resp. [cite_start]Inicial: 10 min, MTTR: Até 6h úteis [cite: 77]\n";
                    [cite_start]response += "**Médio** (Problema): MTTR: 16 a 20 dias úteis [cite: 79]";
                    return response;
                }
                if (lowerCaseMessage.includes("ciclo") || lowerCaseMessage.includes("etapas")) {
                    [cite_start]return "O **Ciclo de Tratamento do Incidente** possui 7 etapas, começando com a **Identificação** [cite: 46] [cite_start]e terminando com o **Encerramento** [cite: 52][cite_start], após a **Resolução e restauração**[cite: 50].\n\n" +
                           [cite_start]"O **Relatório Post-Mortem** é obrigatório em incidentes ou problemas críticos [cite: 63] [cite_start]e deve conter Cronologia, Causa raiz e Ações corretivas[cite: 64, 65, 66].";
                }
                if (lowerCaseMessage.includes("responsabilidades")) {
                    return "As principais responsabilidades são:\n" +
                           [cite_start]"* **Analista de Suporte/NOC:** Identificação, registro, triagem e comunicação[cite: 92].\n" +
                           [cite_start]"* **Equipe Técnica:** Diagnóstico, investigação e implementação de soluções[cite: 94].\n" +
                           [cite_start]"* **Product Owner:** Priorização de problemas e validação de soluções[cite: 93].\n" +
                           [cite_start]"* **Comitê de Gestão:** Revisão de casos críticos e análise de relatórios post-mortem[cite: 71, 72].";
                }
                if (lowerCaseMessage.includes("categorização") || lowerCaseMessage.includes("severidade")) {
                    [cite_start]return "A severidade é classificada em **Crítico, Alto, Médio e Baixo**[cite: 18].\n\n" +
                           [cite_start]"A severidade de **Incidentes** é baseada no **Impacto Real** (interrupção/degradação)[cite: 34].\n" +
                           [cite_start]"A severidade de **Problemas** é baseada no **Impacto Potencial** (causa raiz que pode gerar recorrência)[cite: 39, 21].";
                }
                return "A Política de Incidentes (PL.SC.04.00) está totalmente coberta. [cite_start]Qual aspecto você deseja detalhar (SLA, Ciclo, Responsabilidades, Categorização)? [cite: 4, 3]";
            }

            // --------------------------------------------------------
            // --- DEMAIS ESTADOS E SISTEMAS ---
            // --------------------------------------------------------
            
            const isEndpointRequest = lowerCaseMessage.includes("endpoints") || lowerCaseMessage.includes("todos") || lowerCaseMessage.includes("api") || lowerCaseMessage.includes("rotas");

            if (isEndpointRequest) {
                if (lowerCaseMessage.includes("distrito federal") || lowerCaseMessage.includes("df")) {
                    return "Endpoints Detran-DF:\n\n" +
                           "**Consulta Processo (Valid):** POST /importacaodf/consultarprocesso\n" +
                           "**Envio Aula Teórica:** POST /api/aula/envio-aula-teorica\n" +
                           "**Notificação Biometria:** POST /biometria\n" +
                           "**Consulta CFC/Instrutor:** GET sincronizacaoExterna/centroFormacao/{...}";
                }
                if (lowerCaseMessage.includes("sergipe") || lowerCaseMessage.includes("se")) {
                    return "Endpoints Detran-SE:\n\n" +
                           "**Consulta Veículos:** GET /Monitoramento/veiculo/{codigoCfc}\n" +
                           "**Consulta Candidato:** GET /Monitoramento/Cpf/{cpf}/{tipoAula}/{categoria}/{codigoCfc}\n" +
                           "**Envio de Aulas:** POST /Monitoramento/aula/cadastrar";
                }
                if (lowerCaseMessage.includes("mato grosso do sul") || lowerCaseMessage.includes("ms")) {
                    return "Endpoints Detran-MS (Aulas Práticas):\n\n" +
                           "**URL Base:** https://detranms-superpratico-admin.azurewebsites.net/api/\n" +
                           "**Início Aula Prática:** POST api/pratico/auditoria/aula/inicio\n" +
                           "**Fim Aula:** POST api/pratico/auditoria/aula/fim\n" +
                           "*(Sincronização Teórica MS é via FTP)*";
                }
                if (lowerCaseMessage.includes("superprático") || lowerCaseMessage.includes("geral")) {
                    return "Endpoints SuperPrático (Suporte/Geral):\n\n" +
                           "**Movimentar Bônus:** GET /api/suportepratico/movimentacoes/movimentarBonus/{...}\n" +
                           "**Reprocessar Aulas:** POST /api/suportepratico/reenvio/reprocessar\n" +
                           "**Liberar Alerta:** POST https://hml-{UF}.superprati.co/api/pratico/alerta/Liberar";
                }
                if (isEndpointRequest) {
                    return "Qual estado você deseja consultar? Temos endpoints para **RN**, **DF**, **SE** e **MS**, além dos endpoints de **SuperPrático** de suporte.";
                }
            }

            // --------------------------------------------------------
            // --- RESPOSTA PADRÃO ---
            // --------------------------------------------------------
            return "Desculpe, não consegui encontrar a informação específica. Tente perguntar de forma mais direta, usando o **estado** (RN, DF, SE, MS) e o **tópico** (ex: 'endpoints RN' ou 'MTTR crítico').";
        }
    </script>
</body>

</html>
