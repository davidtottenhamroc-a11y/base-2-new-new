<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Base para N2 - VSoft</title>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
Â  Â  <style>
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background: #0d1a2a;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 1400px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  header {
Â  Â  Â  Â  Â  Â  background: #2c3e50;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .logo {
Â  Â  Â  Â  Â  Â  font-size: 40px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #3498db;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  font-size: 28px;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .description {
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  opacity: 0.9;
Â  Â  Â  Â  }

Â  Â  Â  Â  main {
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .menu-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .menu-card {
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  Â  Â  border: 1px solid #e9ecef;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  padding: 25px;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }

Â  Â  Â  Â  .menu-card:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-5px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  border-color: #3498db;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-icon {
Â  Â  Â  Â  Â  Â  font-size: 40px;
Â  Â  Â  Â  Â  Â  color: #3498db;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-title {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-description {
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  }

Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .menu-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  .logout-button {
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  padding: 12px 25px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #dc3545, #b42a35);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  .logout-button:hover {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #c82333, #a71d24);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Estilos do Chatbot (Modal/Tela Cheia) --- */
Â  Â  Â  Â  #chat-widget-container {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100vw;Â 
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  background: rgba(13, 26, 42, 0.95);Â 
Â  Â  Â  Â  Â  Â  border-radius: 0;
Â  Â  Â  Â  Â  Â  box-shadow: none;
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .chat-content {
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  max-width: 900px;Â 
Â  Â  Â  Â  Â  Â  height: 90%;
Â  Â  Â  Â  Â  Â  max-height: 820px;
Â  Â  Â  Â  Â  Â  background: #ffffff;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #chat-header {
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-header i { margin-right: 10px; }
Â  Â  Â  Â  #chat-close-btn {
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  border: 1px solid white;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  width: 30px;
Â  Â  Â  Â  Â  Â  height: 30px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-close-btn:hover { background: #2980b9; }

Â  Â  Â  Â  #chat-body {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-messages {
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  background: #f8f9fa;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  margin-bottom: 12px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* EstilizaÃ§Ã£o das Mensagens Aprimorada */
Â  Â  Â  Â  .message {
Â  Â  Â  Â  Â  Â  max-width: 90%;Â 
Â  Â  Â  Â  Â  Â  padding: 12px 18px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  font-size: 15px;
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  Â  Â  word-wrap: break-word;
Â  Â  Â  Â  Â  Â  animation: fadeIn 0.3s ease-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .user-message {
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  align-self: flex-end;
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  border-bottom-right-radius: 5px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .bot-message {
Â  Â  Â  Â  Â  Â  background: #e9ecef;Â 
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  align-self: flex-start;
Â  Â  Â  Â  Â  Â  margin-right: auto;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-bottom-left-radius: 5px;Â 
Â  Â  Â  Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â  .bot-message strong { color: #c0392b; }
Â  Â  Â  Â  .bot-message pre {
Â  Â  Â  Â  Â  Â  background: #f4f4f4;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  line-height: 1.3;
Â  Â  Â  Â  }

Â  Â  Â  Â  #chat-input-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  padding: 6px 0;
Â  Â  Â  Â  Â  Â  border-top: 1px solid #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  #estado-filter {
Â  Â  Â  Â  Â  Â  padding: 10px 12px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  width: 120px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-input {
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 25px;
Â  Â  Â  Â  Â  Â  margin-right: 10px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  transition: border-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-input:focus { border-color: #3498db; outline: none; }
Â  Â  Â  Â  #chat-send-btn {
Â  Â  Â  Â  Â  Â  background: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  width: 45px;
Â  Â  Â  Â  Â  Â  height: 45px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  transition: background 0.3s, transform 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-send-btn:hover { background: #218838; }
Â  Â  Â  Â  #chat-send-btn:active { transform: scale(0.95); }

Â  Â  Â  Â  .chat-button {
Â  Â  Â  Â  Â  Â  padding: 8px 12px;
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  margin-top: 8px;
Â  Â  Â  Â  Â  Â  transition: background 0.2s;
Â  Â  Â  Â  Â  Â  display: inline-block;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .chat-button:hover:not(:disabled) { background: #2980b9; }
Â  Â  Â  Â  .chat-button:disabled { background: #ccc; cursor: not-allowed; }

Â  Â  Â  Â  .typing-indicator {
Â  Â  Â  Â  Â  Â  background: #e0e0e0;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

Â  Â  Â  Â  /* --- Estilo do BotÃ£o Flutuante --- */
Â  Â  Â  Â  #chat-open-btn {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  bottom: 30px;
Â  Â  Â  Â  Â  Â  right: 30px;
Â  Â  Â  Â  Â  Â  padding: 15px 20px;
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 30px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-open-btn i { margin-right: 8px; }

Â  Â  Â  Â  mark { background: #ffe58a; padding: 0 3px; border-radius: 2px; }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div class="logo">VSoft</div>
Â  Â  Â  Â  Â  Â  <h1>Base para N2</h1>
Â  Â  Â  Â  Â  Â  <p class="description">Central de guias e documentaÃ§Ãµes tÃ©cnicas para suporte de NÃ­vel 2.</p>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main>
Â  Â  Â  Â  Â  Â  <div class="menu-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="endpoints.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-share-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">DocumentaÃ§Ã£o Endpoints RN</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">DocumentaÃ§Ã£o tÃ©cnica com os Endpoints de RN</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="Sergipe.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-share-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">DocumentaÃ§Ã£o Endpoints SE</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">DocumentaÃ§Ã£o tÃ©cnica com os Endpoints de SE</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="mshm.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-share-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">IntegraÃ§Ãµes DETRAN-MS / Valid</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">DocumentaÃ§Ã£o completa de fluxos, jobs e endpoints de API.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="endpoints_df.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-share-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">Endpoints Credenciadas DF</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">DocumentaÃ§Ã£o completa de fluxos, jobs e endpoints de API.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="SuperPratico.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-share-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">IntegraÃ§Ãµes SuperPrÃ¡tico/ Aulas Praticas</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">DocumentaÃ§Ã£o completa de fluxos Do SuperPrÃ¡tico.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="gerenciamento_incidentes.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-share-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">Politica de gerenciamento de incidentes</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">DocumentaÃ§Ã£o completa do gerenciamento de incidente.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="knowledge_manager.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-database"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">Gerenciar Base de Conhecimento</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">Interface para adicionar e atualizar informaÃ§Ãµes do chatbot por estado (MongoDB).</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="menu2.html" class="menu-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-icon"><i class="fas fa-table"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title">Registro DiÃ¡rios</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-description">Base de registro diÃ¡rio do N2</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  Â  Â  <button class="logout-button" onclick="logout()">Sair</button>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="chat-widget-container">
Â  Â  Â  Â  <div class="chat-content">
Â  Â  Â  Â  Â  Â  <div id="chat-header">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex;align-items:center;gap:8px;"><i class="fas fa-robot"></i> Assistente VSoft N2</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="chat-close-btn" onclick="toggleChat()">X</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="chat-body">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="chat-messages">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="message bot-message">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  OlÃ¡! Sou seu assistente de suporte N2. Minha base de conhecimento Ã© totalmente gerenciada pelo <strong>MongoDB</strong>.<br><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Use o filtro de estado e escreva sua dÃºvida. Por exemplo: <em>"SE veÃ­culos"</em> ou escolha o estado no dropdown.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="chat-input-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="estado-filter">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Todos os estados</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="RN">RN</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="SE">SE</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="MS">MS</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="DF">DF</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PE">PE</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PB">PB</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="BA">BA</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="MG">MG</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="GO">GO</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="MA">MA</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="AL">AL</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="CE">CE</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="TODOS">TODOS</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="chat-input" placeholder="Ex: 'N2 de RN', 'SLA crÃ­tico' ou 'Consulta CFC DF'">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="chat-send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <button id="chat-open-btn" onclick="toggleChat()"><i class="fas fa-comment-dots"></i> Chat N2</button>

Â  Â  Â  Â  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>

Â  Â  <script>
Â  Â  Â  Â  // VariÃ¡veis Globais para o Chatbot
Â  Â  Â  Â  let chatMemories = [];
Â  Â  Â  Â  const VALID_STATES = ['RN', 'DF', 'SE', 'MS', 'PE', 'PB', 'BA', 'MG', 'GO', 'MA', 'AL', 'CE', 'TODOS'];

Â  Â  Â  Â  // DicionÃ¡rio de sinÃ´nimos para buscas mais inteligentes
Â  Â  Â  Â  const SYNONYM_MAP = {
Â  Â  Â  Â  Â  Â  'endpoint': ['api', 'servico', 'url', 'acesso', 'integracao'],
Â  Â  Â  Â  Â  Â  'sla': ['prazo', 'tempo', 'critico', 'atendimento'],
Â  Â  Â  Â  Â  Â  'cfc': ['autoescola', 'credenciada', 'centro'],
Â  Â  Â  Â  Â  Â  'fluxo': ['procedimento', 'passos', 'guia', 'rotina', 'etapa'],
Â  Â  Â  Â  Â  Â  'job': ['servico', 'tarefa', 'rotina', 'processo'],
Â  Â  Â  Â  Â  Â  'incidentes': ['problema', 'erro', 'falha', 'indisponibilidade'],
Â  Â  Â  Â  Â  Â  'consulta': ['pesquisa', 'buscar', 'verificar'],
Â  Â  Â  Â  Â  Â  'veiculos': ['veÃ­culo', 'carro', 'automovel', 'placa']
Â  Â  Â  Â  };

Â  Â  Â  Â  // Stop Words (Palavras comuns que devem ser ignoradas na busca)
Â  Â  Â  Â  const STOP_WORDS_PT = [
Â  Â  Â  Â  Â  Â  'a', 'o', 'as', 'os', 'um', 'uma', 'uns', 'umas', 'de', 'do', 'da', 'dos', 'das', 'e', 'Ã©', 'ou',
Â  Â  Â  Â  Â  Â  'para', 'com', 'sem', 'em', 'por', 'sobre', 'sob', 'atÃ©', 'ao', 'aos', 'Ã ', 'Ã s',
Â  Â  Â  Â  Â  Â  'que', 'qual', 'quais', 'quem', 'onde', 'como', 'quando', 'porque', 'porquÃª', 'pra', 'pela', 'pelo',
Â  Â  Â  Â  Â  Â  'dele', 'dela', 'neste', 'nesta', 'isso', 'este', 'esta', 'ser', 'meu', 'minha', 'meus', 'minhas',
Â  Â  Â  Â  Â  Â  'oii', 'oi', 'ola', 'bom', 'dia', 'tarde', 'noite', 'sobre', 'me', 'meu', 'queria', 'gostaria'
Â  Â  Â  Â  ];

Â  Â  Â  Â  // âš ï¸ ATENÃ‡ÃƒO: Confirme que esta Ã© a URL do seu projeto Vercel
Â  Â  Â  Â  const BACKEND_URL = 'https://base-2-new-new-9xow.vercel.app';

Â  Â  Â  Â  // Fuse index
Â  Â  Â  Â  let fuse = null;
Â  Â  Â  Â  let memoriesIndex = []; // memÃ³rias brutas carregadas
Â  Â  Â  Â  let lastResults = []; // resultados da Ãºltima busca (para paginaÃ§Ã£o)
Â  Â  Â  Â  let resultsPage = 0;
Â  Â  Â  Â  const PAGE_SIZE = 3;

Â  Â  Â  Â  // Guarda as keywords da Ãºltima busca para highlight
Â  Â  Â  Â  let lastQueryKeywords = [];

Â  Â  Â  Â  function logout() {
Â  Â  Â  Â  Â  Â  localStorage.removeItem('agenteSelecionado');
Â  Â  Â  Â  Â  Â  localStorage.removeItem('estadoSelecionado');
Â  Â  Â  Â  Â  Â  window.location.href = 'login.html';
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleChat() {
Â  Â  Â  Â  Â  Â  const chatWidget = document.getElementById('chat-widget-container');
Â  Â  Â  Â  Â  Â  const openBtn = document.getElementById('chat-open-btn');

Â  Â  Â  Â  Â  Â  if (chatWidget.style.display === 'flex') {
Â  Â  Â  Â  Â  Â  Â  Â  chatWidget.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  openBtn.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.overflow = 'auto';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  chatWidget.style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  openBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.overflow = 'hidden';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('chat-input').focus();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  document.addEventListener('keydown', function(event) {
Â  Â  Â  Â  Â  Â  if (event.key === 'Escape' && document.getElementById('chat-widget-container').style.display === 'flex') {
Â  Â  Â  Â  Â  Â  Â  Â  toggleChat();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Helpers de texto e busca ---
Â  Â  Â  Â  function normalizeText(t) {
Â  Â  Â  Â  Â  Â  return (t || '')
Â  Â  Â  Â  Â  Â  Â  Â  .normalize('NFD').replace(/[Ì€-\u036f]/g, '')
Â  Â  Â  Â  Â  Â  Â  Â  .toLowerCase()
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/[^a-z0-9\s]/g, ' ')
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\s+/g, ' ')
Â  Â  Â  Â  Â  Â  Â  Â  .trim();
Â  Â  Â  Â  }

Â  Â  Â  Â  function expandTerms(terms) {
Â  Â  Â  Â  Â  Â  const expanded = new Set();
Â  Â  Â  Â  Â  Â  for (const t of terms) {
Â  Â  Â  Â  Â  Â  Â  Â  expanded.add(t);
Â  Â  Â  Â  Â  Â  Â  Â  const mapped = SYNONYM_MAP[t];
Â  Â  Â  Â  Â  Â  Â  Â  if (mapped) mapped.forEach(s => expanded.add(s));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return Array.from(expanded);
Â  Â  Â  Â  }

Â  Â  Â  Â  function highlight(text, terms) {
Â  Â  Â  Â  Â  Â  let out = text || '';
Â  Â  Â  Â  Â  Â  // Expande as keywords originais com sinÃ´nimos para o destaque ser mais completo
Â  Â  Â  Â  Â  Â  const highlightTerms = expandTerms(terms); 

Â  Â  Â  Â  Â  Â  for (const term of highlightTerms) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!term || term.length < 2) continue;
Â  Â  Â  Â  Â  Â  Â  Â  const safe = term.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&');
Â  Â  Â  Â  Â  Â  Â  Â  // Regex para encontrar a palavra toda, mas permite palavras parciais tambÃ©m
Â  Â  Â  Â  Â  Â  Â  Â  out = out.replace(new RegExp(`(${safe})`, 'ig'), '<mark>$1</mark>');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return out;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Carrega memÃ³rias e cria Ã­ndice Fuse
Â  Â  Â  Â  async function loadMemoriesFromDatabase() {
Â  Â  Â  Â  Â  Â  appendConsoleLog(`Tentando carregar memÃ³rias de: ${BACKEND_URL}/api/memories`);
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${BACKEND_URL}/api/memories`);
Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatMemories = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  memoriesIndex = data.map(m => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...m,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titulo: (m.texto || '').split(':')[0] || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  texto: m.texto || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  texto_normalizado: normalizeText(m.texto || ''),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estado: (m.estado || 'TODOS').toUpperCase()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const options = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  includeScore: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shouldSort: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threshold: 0.35, // mais restrito para evitar resultados irrelevantes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keys: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { name: 'titulo', weight: 0.7 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { name: 'texto', weight: 0.25 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { name: 'estado', weight: 0.05 }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ignoreLocation: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  useExtendedSearch: true
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fuse = new Fuse(memoriesIndex, options);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appendConsoleLog(`[MongoDB] ${memoriesIndex.length} memÃ³rias indexadas com Fuse.`);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appendMessage(`[ERRO ${response.status}] A API retornou um status de erro. O backend Vercel pode estar inativo ou ter falhado ao conectar ao MongoDB.`, 'bot-message');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Erro de rede/conexÃ£o:', error);
Â  Â  Â  Â  Â  Â  Â  Â  appendMessage(`[ERRO DE CONEXÃƒO] NÃ£o foi possÃ­vel acessar o backend Vercel em **${BACKEND_URL}**. Verifique se a URL estÃ¡ correta e se o projeto estÃ¡ implantado e ativo.`, 'bot-message');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  Â  Â  Â  await loadMemoriesFromDatabase();
Â  Â  Â  Â  Â  Â  document.getElementById('chat-open-btn').style.display = 'block';
Â  Â  Â  Â  });

Â  Â  Â  Â  // Enviar com Enter
Â  Â  Â  Â  document.getElementById('chat-input').addEventListener('keypress', function (e) {
Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') sendMessage();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Envio / ciclo de resposta
Â  Â  Â  Â  async function sendMessage() {
Â  Â  Â  Â  Â  Â  const input = document.getElementById('chat-input');
Â  Â  Â  Â  Â  Â  const messageText = input.value.trim();
Â  Â  Â  Â  Â  Â  if (messageText === '') return;
Â  Â  Â  Â  Â  Â  appendMessage(messageText, 'user-message');

Â  Â  Â  Â  Â  Â  // Guardamos o texto em uma variÃ¡vel local para que as funÃ§Ãµes
Â  Â  Â  Â  Â  Â  // posteriores possam usar o texto (nÃ£o dependemos do input.value)
Â  Â  Â  Â  Â  Â  const userMessageForSearch = messageText;
Â  Â  Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  Â  Â  showTypingIndicator();
Â  Â  Â  Â  Â  Â  // pequeno delay para UX
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const botResponse = getBotResponse(userMessageForSearch);
Â  Â  Â  Â  Â  Â  Â  Â  appendMessage(botResponse, 'bot-message');
Â  Â  Â  Â  Â  Â  Â  Â  hideTypeningIndicator();
Â  Â  Â  Â  Â  Â  }, 600);
Â  Â  Â  Â  }

Â  Â  Â  Â  function appendMessage(text, className) {
Â  Â  Â  Â  Â  Â  const messagesContainer = document.getElementById('chat-messages');
Â  Â  Â  Â  Â  Â  const messageDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  messageDiv.className = `message ${className}`;

Â  Â  Â  Â  Â  Â  // Processa blocos de cÃ³digo
Â  Â  Â  Â  Â  Â  const codeBlockRegex = /(```json|```|\{)\n?([\s\S]*?)(\n?```|\n\})/g;
Â  Â  Â  Â  Â  Â  let processedText = text.replace(codeBlockRegex, (match, openTag, content, closeTag) => {
Â  Â  Â  Â  Â  Â  Â  Â  content = content.replace(/```json|```|{|}/g, '').trim();
Â  Â  Â  Â  Â  Â  Â  Â  return `\n<pre>${content}</pre>\n`;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  processedText = processedText.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
Â  Â  Â  Â  Â  Â  messageDiv.innerHTML = processedText;
Â  Â  Â  Â  Â  Â  messagesContainer.appendChild(messageDiv);
Â  Â  Â  Â  Â  Â  messagesContainer.scrollTop = messagesContainer.scrollHeight;
Â  Â  Â  Â  }

Â  Â  Â  Â  function appendConsoleLog(text) {
Â  Â  Â  Â  Â  Â  console.log(text);
Â  Â  Â  Â  }

Â  Â  Â  Â  function showTypingIndicator() {
Â  Â  Â  Â  Â  Â  const messagesContainer = document.getElementById('chat-messages');
Â  Â  Â  Â  Â  Â  const typingDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  typingDiv.className = 'message bot-message typing-indicator';
Â  Â  Â  Â  Â  Â  typingDiv.id = 'typing-indicator';
Â  Â  Â  Â  Â  Â  typingDiv.innerHTML = 'Digitando...';
Â  Â  Â  Â  Â  Â  messagesContainer.appendChild(typingDiv);
Â  Â  Â  Â  Â  Â  messagesContainer.scrollTop = messagesContainer.scrollHeight;
Â  Â  Â  Â  Â  Â  document.getElementById('chat-input').disabled = true;
Â  Â  Â  Â  Â  Â  document.getElementById('chat-send-btn').disabled = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  function hideTypeningIndicator() {
Â  Â  Â  Â  Â  Â  const typingIndicator = document.getElementById('typing-indicator');
Â  Â  Â  Â  Â  Â  if (typingIndicator) typingIndicator.remove();
Â  Â  Â  Â  Â  Â  document.getElementById('chat-input').disabled = false;
Â  Â  Â  Â  Â  Â  document.getElementById('chat-send-btn').disabled = false;
Â  Â  Â  Â  Â  Â  document.getElementById('chat-input').focus();
Â  Â  Â  Â  }

Â  Â  Â  Â  // -------------------------------
Â  Â  Â  Â  // FunÃ§Ã£o getBotResponse (CORRIGIDA)
Â  Â  Â  Â  // -------------------------------
Â  Â  Â  Â  function getBotResponse(message) {
Â  Â  Â  Â  Â  Â  const estadoFilter = (document.getElementById('estado-filter')?.value || '').toUpperCase();
Â  Â  Â  Â  Â  Â  const raw = message.trim();
Â  Â  Â  Â  Â  Â  const normalized = normalizeText(raw);

Â  Â  Â  Â  Â  Â  // 1. EXTRAÃ‡ÃƒO DE KEYWORDS
Â  Â  Â  Â  Â  Â  // keywords iniciais (filtrando stopwords e palavras curtas)
Â  Â  Â  Â  Â  Â  let keywords = normalized.split(/\s+/).filter(w => w.length > 2 && !STOP_WORDS_PT.includes(w));
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Salva as keywords originais (sem sinÃ´nimos) para highlight
Â  Â  Â  Â  Â  Â  lastQueryKeywords = keywords.slice(); 

Â  Â  Â  Â  Â  Â  // expande sinÃ´nimos para a busca (melhora a chance de match)
Â  Â  Â  Â  Â  Â  keywords = expandTerms(keywords);


Â  Â  Â  Â  Â  Â  // 2. DETECÃ‡ÃƒO E FILTRO DE ESTADO
Â  Â  Â  Â  Â  Â  const stateTokens = VALID_STATES.map(s => s.toLowerCase());
Â  Â  Â  Â  Â  Â  const possibleState = normalized.split(/\s+/).find(w => stateTokens.includes(w));
Â  Â  Â  Â  Â  Â  const effectiveState = (estadoFilter || (possibleState ? possibleState.toUpperCase() : '')).toUpperCase();

Â  Â  Â  Â  Â  Â  // Filtra pool por estado (inclui o estado especÃ­fico OU memÃ³rias de 'TODOS')
Â  Â  Â  Â  Â  Â  let pool = memoriesIndex;
Â  Â  Â  Â  Â  Â  if (effectiveState && effectiveState !== 'TODOS' && effectiveState !== '') {
Â  Â  Â  Â  Â  Â  Â  Â  pool = memoriesIndex.filter(m => 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (m.estado || '').toUpperCase() === effectiveState || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (m.estado || '').toUpperCase() === 'TODOS' 
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Se nÃ£o hÃ¡ keywords relevantes, mostra os Ãºltimos registros
Â  Â  Â  Â  Â  Â  if (keywords.length === 0 || pool.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  if (raw.toLowerCase().includes('gerenciar base') || raw.toLowerCase().includes('knowledge')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `Use o menu principal ou acesse o card **Gerenciar Base de Conhecimento** para configurar o MongoDB.`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const list = pool.sort((a, b) => new Date(b.dataHora) - new Date(a.dataHora)).slice(0, 6);
Â  Â  Â  Â  Â  Â  Â  Â  if (list.length === 0) return `NÃ£o encontrei memÃ³rias para o estado ${effectiveState || 'TODOS'}. Use 'Gerenciar Base de Conhecimento' para inserir.`;
Â  Â  Â  Â  Â  Â  Â  Â  lastResults = list;
Â  Â  Â  Â  Â  Â  Â  Â  resultsPage = 0;
Â  Â  Â  Â  Â  Â  Â  Â  return formatResultsPage();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. BUSCA FUSE.JS
Â  Â  Â  Â  Â  Â  // Junta as keywords (incluindo sinÃ´nimos) para a busca no modo Extended Search
Â  Â  Â  Â  Â  Â  const searchQuery = keywords.join(' '); 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  let results = [];
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Cria Fuse local apenas sobre o pool filtrado por estado
Â  Â  Â  Â  Â  Â  Â  Â  const tempFuse = new Fuse(pool, { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  includeScore: true, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threshold: 0.35, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keys: ['titulo', 'texto', 'estado'], 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ignoreLocation: true, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  useExtendedSearch: true 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const fuseResults = tempFuse.search(searchQuery, { limit: 50 });
Â  Â  Â  Â  Â  Â  Â  Â  results = fuseResults.map(r => ({ ...r.item, __fuseScore: r.score }));

Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  // Fallback (caso o Fuse falhe)
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro no Fuse, usando fallback:", e);
Â  Â  Â  Â  Â  Â  Â  Â  results = pool.map(m => ({ ...m, __fuseScore: 1.0 })).filter(m => keywords.every(k =>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (m.texto_normalizado || '').includes(k) || (m.titulo && normalizeText(m.titulo).includes(k))
Â  Â  Â  Â  Â  Â  Â  Â  ));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 4. PÃ“S-PROCESSAMENTO E ORDENAÃ‡ÃƒO
Â  Â  Â  Â  Â  Â  for (const r of results) {
Â  Â  Â  Â  Â  Â  Â  Â  let extra = 0;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // BonificaÃ§Ã£o: palavras-chave no tÃ­tulo
Â  Â  Â  Â  Â  Â  Â  Â  const titleNorm = normalizeText(r.titulo || '');
Â  Â  Â  Â  Â  Â  Â  Â  for (const k of lastQueryKeywords) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (titleNorm.includes(k)) extra += 3;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // BonificaÃ§Ã£o: Match exato de estado
Â  Â  Â  Â  Â  Â  Â  Â  if (effectiveState && effectiveState !== 'TODOS' && (r.estado || '').toUpperCase() === effectiveState) extra += 2;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Calcula o score final (o score do Fuse Ã© melhor quanto mais perto de 0)
Â  Â  Â  Â  Â  Â  Â  Â  const base = (typeof r.__fuseScore === 'number') ? (1 - Math.min(r.__fuseScore, 1)) * 5 : 1;
Â  Â  Â  Â  Â  Â  Â  Â  r._score = base + extra;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const finalMatches = results.sort((a,b) => (b._score || 0) - (a._score || 0));

Â  Â  Â  Â  Â  Â  if (finalMatches.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  return `Desculpe, nÃ£o encontrei uma resposta na base de conhecimento (MongoDB) para essa pesquisa no estado ${effectiveState || 'TODOS'}. Tente termos diferentes ou vÃ¡ em 'Gerenciar Base de Conhecimento'.`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  lastResults = finalMatches;
Â  Â  Â  Â  Â  Â  resultsPage = 0;
Â  Â  Â  Â  Â  Â  return formatResultsPage();
Â  Â  Â  Â  }

Â  Â  Â  Â  // -------------------------------
Â  Â  Â  Â  // formataÃ§Ã£o / paginaÃ§Ã£o / utilitÃ¡rios
Â  Â  Â  Â  // -------------------------------
Â  Â  Â  Â  function formatResultsPage() {
Â  Â  Â  Â  Â  Â  const start = resultsPage * PAGE_SIZE;
Â  Â  Â  Â  Â  Â  const end = start + PAGE_SIZE;
Â  Â  Â  Â  Â  Â  const page = lastResults.slice(start, end);
Â  Â  Â  Â  Â  Â  if (page.length === 0) return 'Nenhum resultado nesta pÃ¡gina.';

Â  Â  Â  Â  Â  Â  const total = lastResults.length;
Â  Â  Â  Â  Â  Â  const listFormatted = page.map(m => {
Â  Â  Â  Â  Â  Â  Â  Â  const date = m.dataHora ? new Date(m.dataHora).toLocaleDateString('pt-BR') : '';
Â  Â  Â  Â  Â  Â  Â  Â  const parts = (m.texto || '').split(':');
Â  Â  Â  Â  Â  Â  Â  Â  const title = parts[0] || m.titulo || 'Sem tÃ­tulo';
Â  Â  Â  Â  Â  Â  Â  Â  const content = parts.length > 1 ? parts.slice(1).join(':') : m.texto || '';
Â  Â  Â  Â  Â  Â  Â  Â  // usa lastQueryKeywords que foi salvo durante a busca
Â  Â  Â  Â  Â  Â  Â  Â  const keywordsFromQuery = lastQueryKeywords || [];
Â  Â  Â  Â  Â  Â  Â  Â  const highlighted = highlight(content, keywordsFromQuery);
Â  Â  Â  Â  Â  Â  Â  Â  const img = m.imagemUrl ? `<br><img src="${m.imagemUrl}" style="max-width:100%;border-radius:6px;margin-top:8px;">` : '';
Â  Â  Â  Â  Â  Â  Â  Â  const id = m._id || m.id || (m.idMemoria || '') || '';
Â  Â  Â  Â  Â  Â  Â  Â  const actions = `<br><div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;"><button class="chat-button" onclick="showFullMemory('${id}')">Ver Mais</button><button class="chat-button" onclick="sendFeedback('${id}', true)">ğŸ‘</button><button class="chat-button" onclick="sendFeedback('${id}', false)">ğŸ‘</button></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  return `**[${m.estado || 'TODOS'}] ${title}**\n\n${highlighted} (Agente: ${m.agente || 'â€”'}, ${date})${img}${actions}`;
Â  Â  Â  Â  Â  Â  }).join('\n\n---\n\n');

Â  Â  Â  Â  Â  Â  const remaining = Math.max(0, total - ((resultsPage + 1) * PAGE_SIZE));
Â  Â  Â  Â  Â  Â  const moreBtn = remaining > 0 ? `\n\n<button class="chat-button" onclick="showMoreResults()">Mostrar mais (${remaining} restantes)</button>` : '\n\n*Fim da lista.*';
Â  Â  Â  Â  Â  Â  return `Encontrei **${total}** referÃªncias.\n\n${listFormatted}${moreBtn}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function collectLastQueryKeywords() {
Â  Â  Â  Â  Â  Â  return lastQueryKeywords || [];
Â  Â  Â  Â  }

Â  Â  Â  Â  function showMoreResults() {
Â  Â  Â  Â  Â  Â  resultsPage += 1;
Â  Â  Â  Â  Â  Â  appendMessage(formatResultsPage(), 'bot-message');
Â  Â  Â  Â  }

Â  Â  Â  Â  function showFullMemory(id) {
Â  Â  Â  Â  Â  Â  const mem = memoriesIndex.find(m => (m._id === id || m.id === id || (m.idMemoria === id)));
Â  Â  Â  Â  Â  Â  if (!mem) { appendMessage('ConteÃºdo nÃ£o encontrado', 'bot-message'); return; }
Â  Â  Â  Â  Â  Â  appendMessage(`**${mem.titulo}**\n\n${mem.texto}\n\n(Agente: ${mem.agente}, ${new Date(mem.dataHora).toLocaleString('pt-BR')})`, 'bot-message');
Â  Â  Â  Â  }

Â  Â  Â  Â  async function sendFeedback(id, positive) {
Â  Â  Â  Â  Â  Â  if (!id) { appendMessage('ID da memÃ³ria invÃ¡lido para feedback.', 'bot-message'); return; }
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await fetch(`${BACKEND_URL}/api/memories/feedback`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {'Content-Type': 'application/json'},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ id, positive })
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  appendMessage(positive ? 'Obrigado pelo feedback positivo!' : 'Obrigado, registramos o feedback e iremos revisar.', 'bot-message');
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  appendMessage('Erro ao enviar feedback.', 'bot-message');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  </script>
</body>
</html>
